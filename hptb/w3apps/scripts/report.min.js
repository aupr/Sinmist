$server1200="http://192.168.10.5/awp/MIST/start.html";var reportLimit=50;$(document).ready(function(){$("#btn-origin").click(function(){window.location.replace("origin.php")});$("#btn-settings").click(function(){it_modal_open()});$("#btn-set-formula").click(function(){$.post("reportmodules/ui/takeformula.php",{},function(a){it_modal_open("Set Formula ...",a,"dodgerblue","800px","Set, Cancel",function(b){if(b=="Cancel"){it_modal_close()}else{if(b=="Set"){it_modal_loading();setFormula(function(){it_modal_close()})}}})})});$("#btn-toggle-fscr").click(function(){it_fullscreen_toggle()});$("#btn-create-model").click(function(){$.post("reportmodules/ui/createreport.php",{},function(a){it_modal_open('<i class="fa fa-plus-square-o" aria-hidden="true"></i> Create a new report...',a,"blueviolet","1000px","Create, Cancel",function(b){if(b=="Create"){it_modal_loading();onClick(function(){it_modal_close();$("#btn-view-models").click()})}else{if(b=="Cancel"){it_modal_close()}}})}).fail(function(){alert("Failed to load ui!!")})});$("#btn-view-models").click(function(){pagination("model",1,reportLimit);$("#report-list-title").text("Uncompleted Report List")});$("#btn-view-reports").click(function(){pagination("report",1,reportLimit);$("#report-list-title").text("Completed Report List")});$.post("reportmodules/contents.php",{type:"model",limitStart:1,limit:2},function(a){if(a.data.length){$("#btn-view-models").click()}else{$("#btn-view-reports").click()}},"json").fail(function(){alert("Failed to data communicate!")});$("#find-btn").click(function(){var a=$("#find-keyword").val();a=it_input_filter(a);if(a.length<2){it_modal_open("Invalid Key word !","Keyword should be at least two characters...","dodgerblue",0,"Got it !",function(b){if(b){it_modal_close()}})}else{pagination("find",1,reportLimit,makeKeywords(a));$("#report-list-title").text("Report List - Search Result")}});$("#ac-btn-delete-report").click(function(){if(isSelected()){it_modal_open("Confirm !","Do you want to delete this?","#d9534f",0,"Yes, No",function(a){if(a=="Yes"){it_modal_loading();$.post("reportmodules/action.php",{command:"delete","for":"report",id:selected.objectId},function(b){it_modal_close();if(selected.type=="model"){$("#btn-view-models").click()}else{if(selected.type=="report"){$("#btn-view-reports").click()}}})}else{if(a=="No"){it_modal_close()}}})}});$("#ac-btn-edit-report").click(function(){if(isSelected()){$.post("reportmodules/ui/editreport.php",{id:selected.objectId},function(a){it_modal_open("Report Edit Form . . .",a,"#FF8800","1100px","Save, Cancel",function(b){if(b=="Save"){it_modal_loading();onSave(selected.objectId,function(d,c){it_modal_close();if(c){$("#btn-view-reports").click()}else{$("#btn-view-models").click()}})}else{if(b=="Cancel"){it_modal_close()}}})}).fail(function(){alert("failed to load edit report ui")})}});$("#ac-btn-take-data-into-report").click(function(){if(isSelected()){it_modal_open("Confirm !","Do you want to take data into ths report?","#007E33",0,"Yes, No",function(a){if(a=="Yes"){it_modal_close();if(selected.type=="report"){it_modal_open("Confirm again !...","<b>All of the previous data will be lost!</b><br>Do you want to continue?","#d2b521","500px","Yes, No",function(c){if(c=="Yes"){it_modal_close();var d=window.open($server1200+"?id="+selected.objectId+"&type="+selected.type,"_blank");d.focus()}else{it_modal_close()}})}else{var b=window.open($server1200+"?id="+selected.objectId+"&type="+selected.type,"_blank");b.focus()}}else{if(a=="No"){it_modal_close()}}})}});$("#ac-btn-view-report-modal").click(function(){if(isSelected()){var a='<div class="input-group" style="width: 340px; margin: 20px 20px;"><label class="input-group-addon no-radius" for="selectSensor">Select Sensor Type:</label><select class="form-control no-radius" id="selectSensor"><option value="M">Magnetic</option><option value="U">Ultrasonic</option></select></div>';if(selected.type=="report"){it_modal_open("Choose Sensor ...",a,"dodgerblue","400px","Continue, Cancel",function(b){if(b=="Continue"){$.post("reportmodules/ui/viewreport.php",{id:selected.objectId,sensor:$("#selectSensor").val(),type:selected.type},function(c){it_modal_open("Report View Form . . .",c,"#0099CC","1100px","Cancel",function(d){if(d=="Save"){it_modal_loading();onSave(selected.objectId,function(f,e){it_modal_close();if(e){$("#btn-view-reports").click()}else{$("#btn-view-models").click()}})}else{if(d=="Cancel"){it_modal_close()}}})}).fail(function(){alert("failed to load view report ui")})}else{if(b=="Cancel"){it_modal_close()}}})}else{$.post("reportmodules/ui/viewreport.php",{id:selected.objectId,sensor:$("#selectSensor").val(),type:selected.type},function(b){it_modal_open("Report View Form . . .",b,"#0099CC","1100px","Cancel",function(c){if(c=="Save"){it_modal_loading();onSave(selected.objectId,function(e,d){it_modal_close();if(d){$("#btn-view-reports").click()}else{$("#btn-view-models").click()}})}else{if(c=="Cancel"){it_modal_close()}}})}).fail(function(){alert("failed to load view report ui")})}}});$("#ac-btn-make-report-page").click(function(){if(selected.type==="report"){if(isSelected()){var a='<div class="input-group" style="width: 340px; margin: 20px 20px;"><label class="input-group-addon no-radius" for="selectSensor">Select Sensor Type:</label><select class="form-control no-radius" id="selectSensor"><option value="M">Magnetic</option><option value="U">Ultrasonic</option></select></div>';it_modal_open("Choose Sensor ...",a,"dodgerblue","400px","Continue, Cancel",function(b){if(b=="Continue"){var c=window.open("reportpage.php?id="+selected.objectId+"&sensor="+$("#selectSensor").val(),"_blank");c.focus();it_modal_close()}else{if(b=="Cancel"){it_modal_close()}}})}}else{it_modal_error("It's not applicable for uncompleted report !")}});$("#find-keyword").keypress(function(a){if((a.keyboard==13)||(a.which==13)){$("#find-btn").click()}})});var selected={elementId:0,objectId:0,type:""};function selectThis(b,a){$(selected.elementId).css({"background-color":"initial",color:"#333"});$(b).css({"background-color":"#a2a2a2",color:"white"});selected.elementId=b;selected.objectId=a}function isSelected(){if(selected.objectId!==0){return true}else{it_modal_warning("Please select a report element first!");return false}}function setContentTable(e,h,a,b,g){if(e=="model"){var d=$.post("reportmodules/contents.php",{type:e,limitStart:h,limit:a},function(j){var i='<table class="table table-bordered"><thead><tr><th>Received dt</th><th>ME Ref.</th><th>Client</th><th>Supplier</th><th>Pump Type</th><th>Pump-SN</th><th>Motor-SN</th></tr></thead><tbody>';j.data.forEach(function(k){i+='<tr onclick="selectThis(this, '+k.id+')"><td>'+k.rDt+"</td><td>"+k.meRef+"</td><td>"+k.client+"</td><td>"+k.supplier+"</td><td>"+k.pumpType+"</td><td>"+k.pumpSn+"</td><td>"+k.motorSn+"</td></tr>"});i+="</tbody></table>";selected.type=e;$("#reportContainer").html(i);g(j.totalData)},"json");d.fail(function(){alert("Failed to data load !")})}else{if(e=="report"){var c=$.post("reportmodules/contents.php",{type:e,limitStart:h,limit:a},function(j){var i='<table class="table table-bordered"><thead><tr><th>Received dt</th><th>Test dt & time</th><th>ME Ref.</th><th>Client</th><th>Supplier</th><th>Pump Type</th><th>Pump-SN</th><th>Motor-SN</th></tr></thead><tbody>';j.data.forEach(function(k){i+='<tr onclick="selectThis(this, '+k.id+')"><td>'+k.rDt+"</td><td>"+k.tDtTm+"</td><td>"+k.meRef+"</td><td>"+k.client+"</td><td>"+k.supplier+"</td><td>"+k.pumpType+"</td><td>"+k.pumpSn+"</td><td>"+k.motorSn+"</td></tr>"});i+="</tbody></table>";selected.type=e;$("#reportContainer").html(i);g(j.totalData)},"json");c.fail(function(){alert("Failed to data load !")})}else{if(e=="find"){var f=$.post("reportmodules/contents.php",{type:e,limitStart:h,limit:a,keywords:b},function(j){var i='<table class="table table-bordered"><thead><tr><th>Received dt</th><th>Test dt & time</th><th>ME Ref.</th><th>Client</th><th>Supplier</th><th>Pump Type</th><th>Pump-SN</th><th>Motor-SN</th></tr></thead><tbody>';j.data.forEach(function(k){i+='<tr onclick="selectThis(this, '+k.id+')"><td>'+k.rDt+"</td><td>"+k.tDtTm+"</td><td>"+k.meRef+"</td><td>"+k.client+"</td><td>"+k.supplier+"</td><td>"+k.pumpType+"</td><td>"+k.pumpSn+"</td><td>"+k.motorSn+"</td></tr>"});i+="</tbody></table>";selected.type=e;$("#reportContainer").html(i);g(j.totalData)},"json");f.fail(function(){alert("Failed to data load !")})}}}selected.elementId=0;selected.objectId=0}function pagination(c,d,a,b){setContentTable(c,d,a,b,function(f){var e=$("#report-previous-page");var h=$("#report-next-page");var g=((d+a-1)>=f)?f:(d+a-1);$("#report-page-info").text(d+"-"+g+" of "+f);if(d==1){e.hide()}else{e.show()}if((d+a-1)>=f){h.hide()}else{h.show()}e.unbind("click");e.click(function(){pagination(c,d-a,a,b)});h.unbind("click");h.click(function(){pagination(c,d+a,a,b)})})}function makeKeywords(d){var e=" LIKE '%"+d+"%'";var b=false;var c="(";if($("#ckbx-rcvd-date").prop("checked")){if(!b){b=true}else{c+=" or "}c+="rDt"+e}if($("#ckbx-tst-date").prop("checked")){if(!b){b=true}else{c+=" or "}c+="tDtTm"+e}if($("#ckbx-client").prop("checked")){if(!b){b=true}else{c+=" or "}c+="client"+e}if($("#ckbx-supplier").prop("checked")){if(!b){b=true}else{c+=" or "}c+="supplier"+e}if($("#ckbx-me-ref").prop("checked")){if(!b){b=true}else{c+=" or "}c+="meRef"+e}if($("#ckbx-pump-type").prop("checked")){if(!b){b=true}else{c+=" or "}c+="pumpType"+e}if($("#ckbx-pump-sn").prop("checked")){if(!b){b=true}else{c+=" or "}c+="pumpSn"+e}if($("#ckbx-motor-sn").prop("checked")){if(!b){b=true}else{c+=" or "}c+="motorSn"+e}if(b){c+=")"}else{c="(rDt"+e+" or tDtTm"+e+" or client"+e+" or supplier"+e+" or meRef"+e+" or pumpType"+e+" or pumpSn"+e+" or motorSn"+e+")"}var a=$("#ckbx-uncompleted-report").prop("checked");var f=$("#ckbx-completed-report").prop("checked");if(a!=f){if(a){c+=" and testData=''"}else{c+=" and testData!=''"}}return c};